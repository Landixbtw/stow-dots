;;; mail.el --- Mail configuration -*- lexical-binding: t; -*-
;;; Commentary:

;;; Code:

;; 1. Identity
(setq user-mail-address "owmlea@gmail.com"
      user-full-name    "Ole Wortmann")

;; 2. SMTP Settings (Outgoing)
;; These variables tell the 'smtpmail' library how to talk to Gmail.
(setq smtpmail-smtp-server "smtp.gmail.com"
      smtpmail-smtp-service 587
      smtpmail-stream-type 'starttls)

;; 3. Delivery Method
;; These are CRITICAL. They tell Emacs to use the SMTP settings above
;; instead of trying to use a local system mailer (like /usr/sbin/sendmail).
(setq message-send-mail-function 'message-send-mail-with-smtp
      send-mail-function 'smtpmail-send-it)

(use-package mu4e
  :ensure nil
  :load-path "/usr/local/share/emacs/site-lisp/mu4e/"
  :config
  ;; -- Basics --
  (setq mu4e-change-filenames-when-moving t
        mu4e-update-interval (* 10 60)
        mu4e-get-mail-command "mbsync -a")

  ;; -- Folders --
  ;; Ensure these match the actual folder names in your ~/Maildir
  (setq mu4e-drafts-folder "/[Gmail]/Drafts"
        mu4e-sent-folder   "/[Gmail]/Sent Mail"
        mu4e-refile-folder "/[Gmail]/All Mail"
        mu4e-trash-folder  "/[Gmail]/Trash")

  ;; -- Shortcuts --
  (setq mu4e-maildir-shortcuts
        '((:maildir "/Inbox"             :key ?i)
          (:maildir "/[Gmail]/Sent Mail" :key ?s)
          (:maildir "/[Gmail]/Trash"     :key ?t)
          (:maildir "/[Gmail]/Drafts"    :key ?d)
          (:maildir "/[Gmail]/All Mail"  :key ?a)))

  ;; -- Composing --
  ;; This ensures that when you reply, mu4e uses the correct address
  (setq message-signature nil
        mu4e-compose-format-flowed t))

;; 4. Debugging (Uncomment these only if sending fails)
;; (setq smtpmail-debug-info t
;;       smtpmail-debug-verbose t)

(provide 'mail)

;;; mail.el ends here
